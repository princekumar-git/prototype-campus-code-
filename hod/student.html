<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Students - Faculty Dashboard</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ["Poppins", "sans-serif"] },
                    colors: {
                        primary: { 50: "#E7F0FA", 100: "#D0E1F5", 200: "#7BA4D0", 300: "#4D84C0", 400: "#2E5E99", 500: "#1E4A7A", 600: "#0D2440" },
                        dark: { bg: "#111827", card: "#1F2937", text: "#F9FAFB", border: "#374151" }
                    },
                },
            },
        };
    </script>
    <style>
        .sidebar::-webkit-scrollbar { width: 6px; }
        .sidebar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }
        .dark .sidebar::-webkit-scrollbar-thumb { background-color: #4b5563; }
        
        .sidebar.collapsed { width: 5rem; }
        .sidebar.collapsed span { display: none; }
        .sidebar.collapsed .nav-item { justify-content: center; padding-left: 0; padding-right: 0; }
        
        /* Navbar Links */
        .nav-item { position: relative; transition: all 0.2s ease; }
        
        /* Active Link Style */
        .nav-item.active { background-color: #E7F0FA; color: #1E4A7A; }
        .dark .nav-item.active { background-color: #1F2937; color: #60A5FA; }
        
        .nav-item.active::before {
            content: ""; position: absolute; left: 0; top: 50%; transform: translateY(-50%);
            height: 60%; width: 4px; background-color: #1E4A7A; border-radius: 0 4px 4px 0;
        }
        .dark .nav-item.active::before { background-color: #60A5FA; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.2s ease-out forwards; }
    </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 min-h-screen font-sans transition-colors duration-200 text-gray-800 dark:text-gray-200">
    <div class="flex h-screen overflow-hidden">
        
        <aside id="mainSidebar" class="sidebar w-64 bg-white dark:bg-gray-800 shadow-sm border-r border-gray-200 dark:border-gray-700 flex flex-col h-screen flex-shrink-0 transition-all duration-300 z-50">

    <div class="p-6 flex-shrink-0 flex items-center justify-between h-[88px]">
        <h1 class="text-2xl font-bold text-gray-800 dark:text-white flex items-center gap-2 overflow-hidden whitespace-nowrap">
            <i class="fas fa-code text-primary-500 text-2xl flex-shrink-0"></i>
            <span id="sidebarLogoText" class="transition-all duration-300 opacity-100">CampusCode</span>
        </h1>
        <button id="sidebarToggleBtn" class="p-1.5 rounded-lg text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-primary-500 transition-colors focus:outline-none">
            <i class="fas fa-chevron-left transition-transform duration-300"></i>
        </button>
    </div>

    <nav class="flex-1 space-y-1 overflow-y-auto mt-2 font-sans">
        
        <a href="dashboard.html" class="group flex items-center gap-3 px-6 py-3.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white transition-all border-r-4 border-transparent">
    <i class="fas fa-home w-5 text-center text-lg"></i>
    <span class="whitespace-nowrap">Dashboard</span>
</a>

        <a href="problem.html" class="group flex items-center gap-3 px-6 py-3.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white transition-all border-r-4 border-transparent">
            <i class="fas fa-tasks w-5 text-center text-lg group-hover:scale-110 transition-transform"></i>
            <span class="whitespace-nowrap">Problems</span>
        </a>

        <a href="contest.html" class="group flex items-center gap-3 px-6 py-3.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white transition-all border-r-4 border-transparent">
            <i class="fas fa-trophy w-5 text-center text-lg"></i>
            <span class="whitespace-nowrap">Contests</span>
        </a>

        <a href="faculty.html" class="group flex items-center gap-3 px-6 py-3.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white transition-all border-r-4 border-transparent">
            <i class="fas fa-users w-5 text-center text-lg group-hover:scale-110 transition-transform"></i>
            <span class="whitespace-nowrap">Faculty</span>
        </a>

        <a href="student.html" class="group flex items-center gap-3 px-6 py-3.5 text-sm font-medium bg-primary-50 dark:bg-primary-900/20 text-primary-600 dark:text-primary-400 border-r-4 border-primary-600 dark:border-primary-400 transition-all">
            <i class="fas fa-users w-5 text-center text-lg group-hover:scale-110 transition-transform"></i>
            <span class="whitespace-nowrap">Students</span>
        </a>

        <a href="community.html" class="group flex items-center gap-3 px-6 py-3.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white transition-all border-r-4 border-transparent">
            <i class="fas fa-comments w-5 text-center text-lg group-hover:scale-110 transition-transform"></i>
            <span class="whitespace-nowrap">Community</span>
        </a>

        <a href="report.html" class="group flex items-center gap-3 px-6 py-3.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white transition-all border-r-4 border-transparent">
            <i class="fas fa-chart-pie w-5 text-center text-lg group-hover:scale-110 transition-transform"></i>
            <span class="whitespace-nowrap">Reports</span>
        </a>

    </nav>

    <div class="p-4 space-y-1 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex-shrink-0">
        
        <a href="help.html" class="group flex items-center gap-3 px-6 py-3.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white transition-all rounded-lg">
            <i class="far fa-question-circle w-5 text-center text-lg group-hover:scale-110 transition-transform"></i>
            <span class="whitespace-nowrap">Help & Support</span>
        </a>

        <div id="settingsTrigger" class="group flex items-center gap-3 px-6 py-3.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white transition-all rounded-lg cursor-pointer">
            <i class="fas fa-cog w-5 text-center text-lg group-hover:rotate-90 transition-transform duration-500"></i>
            <span class="whitespace-nowrap">Settings</span>
        </div>

    </div>
</aside>

        <div class="flex-1 overflow-y-auto">
            <header class="bg-white dark:bg-gray-800 shadow-sm transition-colors duration-200 sticky top-0 z-20">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
                    <div class="flex-1 max-w-2xl ml-4 flex items-center gap-4">
                        <h1 id="headerLogoText" class="text-xl font-bold text-gray-800 dark:text-white hidden transition-all duration-300 opacity-0 transform -translate-x-2 whitespace-nowrap">CampusCode</h1>
                        <h2 id="page-title" class="text-xl font-bold text-gray-800 dark:text-white ml-2">Students</h2>
                        <div class="relative flex items-center w-full max-w-md ml-4">
                             <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-search text-gray-400"></i></div>
                             <input type="text" class="block w-full pl-10 pr-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary-400 placeholder-gray-500" placeholder="Search..." />
                        </div>
                    </div>
                    <div class="ml-4 flex items-center gap-3">
                        <button id="themeToggleBtn" class="p-2 rounded-full text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 focus:outline-none transition-transform active:scale-95"><i class="fas fa-moon text-xl"></i></button>
                        <div class="relative">
                            <button id="notificationBtn" class="p-2 rounded-full text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 focus:outline-none">
                                <i class="fas fa-bell text-xl"></i><span class="absolute top-0 right-0 h-2 w-2 rounded-full bg-red-500 border-2 border-white dark:border-gray-800"></span>
                            </button>
                        </div>
                        <button id="headerProfileBtn" class="ml-2 flex items-center gap-3 p-1 pr-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <div class="h-9 w-9 rounded-full bg-primary-500 flex items-center justify-center text-white font-bold text-sm">JD</div>
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-200 hidden sm:block">Dr. John Doe</span>
                        </button>
                    </div>
                </div>
            </header>

            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 relative">
                <div id="student-list-container" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700 mb-6">
                    <div class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div class="relative max-w-md flex-1 w-full">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-search text-gray-400"></i></div>
                            <input type="text" id="studentSearchInput" class="block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 bg-white dark:bg-gray-700 text-sm text-gray-900 dark:text-white" placeholder="Search student by Name, ID, or Email...">
                        </div>
                        <button id="btn-add-student" class="bg-primary-500 hover:bg-primary-600 text-white px-6 py-2 rounded-lg text-sm font-semibold transition-colors shadow-sm whitespace-nowrap"><i class="fas fa-plus mr-2"></i> Add Student</button>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div><label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Section</label><select class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm p-2.5 text-gray-900 dark:text-white"><option>All Sections</option><option>Section A</option><option>Section B</option></select></div>
                        <div><label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Year</label><select class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm p-2.5 text-gray-900 dark:text-white"><option>All Years</option><option>1st Year</option><option>2nd Year</option><option>3rd Year</option></select></div>
                        <div><label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Subject</label><select class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm p-2.5 text-gray-900 dark:text-white"><option>All Subjects</option><option>DSA</option><option>Algorithms</option></select></div>
                        <div><label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Sort By</label><select class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm p-2.5 text-gray-900 dark:text-white"><option>Recent</option><option>Name</option><option>Rank</option></select></div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm" id="studentsTable">
                            <thead class="bg-gray-50 dark:bg-gray-700/50 text-gray-500 dark:text-gray-400">
                                <tr>
                                    <th class="px-6 py-3 font-semibold uppercase tracking-wider text-xs">ID</th>
                                    <th class="px-6 py-3 font-semibold uppercase tracking-wider text-xs">Name</th>
                                    <th class="px-6 py-3 font-semibold uppercase tracking-wider text-xs">Section</th>
                                    <th class="px-6 py-3 font-semibold uppercase tracking-wider text-xs">Year</th>
                                    <th class="px-6 py-3 font-semibold uppercase tracking-wider text-xs">Email</th>
                                    <th class="px-6 py-3 font-semibold uppercase tracking-wider text-xs">Global Rank</th>
                                    <th class="px-6 py-3 font-semibold uppercase tracking-wider text-xs">Status</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100 dark:divide-gray-700 border-t border-gray-100 dark:border-gray-700">
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer student-row" data-id="2302920100126" data-name="Sagar Kumar" data-email="sagar.kumar@mit.ac.in" data-section="A" data-year="2nd Year" data-solved="124" data-rank="42" data-points="1.2k">
                                    <td class="px-6 py-4 text-gray-600 dark:text-gray-300">2302920100126</td>
                                    <td class="px-6 py-4 font-medium text-gray-900 dark:text-white"><div class="hover:text-primary-600 hover:underline">Sagar Kumar</div></td>
                                    <td class="px-6 py-4 text-gray-600 dark:text-gray-300">A</td>
                                    <td class="px-6 py-4 text-gray-600 dark:text-gray-300">2nd Year</td>
                                    <td class="px-6 py-4 text-gray-600 dark:text-gray-300">sagar.kumar@mit.ac.in</td>
                                    <td class="px-6 py-4"><span class="inline-flex items-center px-2.5 py-1 rounded bg-primary-500 text-white text-xs font-medium">12</span></td>
                                    <td class="px-6 py-4"><span class="inline-flex items-center px-3 py-1 rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 text-xs font-medium">Active</span></td>
                                </tr>
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer student-row" data-id="2302920100127" data-name="Priya Sharma" data-email="priya.sharma@mit.ac.in" data-section="B" data-year="3rd Year" data-solved="200" data-rank="5" data-points="2.5k">
                                    <td class="px-6 py-4 text-gray-600 dark:text-gray-300">2302920100127</td>
                                    <td class="px-6 py-4 font-medium text-gray-900 dark:text-white"><div class="hover:text-primary-600 hover:underline">Priya Sharma</div></td>
                                    <td class="px-6 py-4 text-gray-600 dark:text-gray-300">B</td>
                                    <td class="px-6 py-4 text-gray-600 dark:text-gray-300">3rd Year</td>
                                    <td class="px-6 py-4 text-gray-600 dark:text-gray-300">priya.sharma@mit.ac.in</td>
                                    <td class="px-6 py-4"><span class="inline-flex items-center px-2.5 py-1 rounded bg-primary-500 text-white text-xs font-medium">5</span></td>
                                    <td class="px-6 py-4"><span class="inline-flex items-center px-3 py-1 rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 text-xs font-medium">Active</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="student-form-view" class="hidden animate-fadeIn bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 max-w-3xl mx-auto mt-6">
                    <div class="p-8">
                        <div class="flex items-center justify-between mb-8">
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white flex items-center gap-3">
                                <span class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 flex items-center justify-center"><i class="fas fa-user-plus"></i></span>
                                New Student Registration
                            </h2>
                            <button id="btn-back-to-student-list" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"><i class="fas fa-times text-xl"></i></button>
                        </div>
                        <form class="space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Full Name</label><input type="text" class="block w-full p-2.5 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white"></div>
                                <div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Email</label><input type="email" class="block w-full p-2.5 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white"></div>
                                <div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Student ID</label><input type="text" class="block w-full p-2.5 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white"></div>
                                <div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Section</label><select class="block w-full p-2.5 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white"><option>Section A</option><option>Section B</option></select></div>
                            </div>
                            <div class="flex justify-end gap-4">
                                <button type="button" id="btn-cancel-student-form" class="px-6 py-2.5 text-red-600 bg-red-50 rounded-lg">Cancel</button>
                                <button type="submit" class="px-8 py-2.5 text-white bg-green-600 rounded-lg">Register</button>
                            </div>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="settingsMenu" class="hidden fixed bottom-16 left-4 w-72 bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 shadow-2xl rounded-2xl z-[9999] p-2">
        <div class="px-3 py-2 text-xs font-semibold text-gray-400 uppercase">Preferences</div>
        <button id="themeAccordionBtn" class="w-full flex justify-between items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl">
            <div class="flex items-center gap-3"><i class="fas fa-palette w-5 text-gray-400"></i> Theme</div>
            <i id="themeChevron" class="fas fa-chevron-right text-xs text-gray-400"></i>
        </button>
        <div id="themeOptionsContainer" class="hidden pl-4 pr-1 space-y-1 mt-1">
            <button data-value="light" class="theme-option w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700">Light <i class="fas fa-check text-primary-500 opacity-0 check-icon"></i></button>
            <button data-value="dark" class="theme-option w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700">Dark <i class="fas fa-check text-primary-500 opacity-0 check-icon"></i></button>
        </div>
    </div>

    

    <div id="profileOverlay" class="fixed inset-0 z-[80] flex items-center justify-center bg-black/50 backdrop-blur-sm hidden">
        <div class="w-[380px] bg-white dark:bg-gray-800 rounded-3xl shadow-2xl overflow-hidden animate-[fadeIn_0.2s_ease-out]">
            <div class="bg-gradient-to-br from-[#1E4A7A] to-[#153255] relative pt-12 pb-20 px-6 text-center">
                <button id="closeProfileOverlay" class="absolute top-4 right-4 w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 text-white/90 transition-all flex items-center justify-center backdrop-blur-sm">
                    <i class="fas fa-times text-sm"></i>
                </button>
                <div class="absolute left-1/2 bottom-[-48px] -translate-x-1/2">
                    <div class="relative w-24 h-24 rounded-full p-1.5 bg-white dark:bg-gray-800 ring-4 ring-[#1E4A7A]/10 dark:ring-[#1E4A7A]/30">
                        <div class="w-full h-full rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white text-3xl font-bold shadow-inner">
                            JD
                        </div>
                        <div class="absolute bottom-0 right-0 w-6 h-6 bg-green-500 border-4 border-white dark:border-gray-800 rounded-full"></div>
                    </div>
                </div>
            </div>
            <div class="pt-16 pb-8 px-6">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-1">Dr. John Doe</h2>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-3">Senior Professor & Researcher</p>
                    <div class="flex items-center justify-center gap-2 flex-wrap">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 border border-blue-100 dark:border-blue-800">CSE Dept</span>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-purple-50 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 border border-purple-100 dark:border-purple-800">Faculty</span>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="p-3 rounded-2xl bg-gray-50 dark:bg-gray-700/30 border border-gray-100 dark:border-gray-700 text-center">
                         <p class="text-xs text-gray-500 uppercase font-semibold">Faculty ID</p>
                         <p class="text-sm font-bold text-gray-800 dark:text-gray-200">FAC-2023</p>
                    </div>
                    <div class="p-3 rounded-2xl bg-gray-50 dark:bg-gray-700/30 border border-gray-100 dark:border-gray-700 text-center">
                        <p class="text-xs text-gray-500 uppercase font-semibold">Joined</p>
                        <p class="text-sm font-bold text-gray-800 dark:text-gray-200">Aug 2015</p>
                   </div>
                </div>
                <div class="space-y-3">
                      <button id="logoutBtn" class="w-full flex items-center justify-between p-3 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 group transition-all duration-200 border border-transparent hover:border-red-100 dark:hover:border-red-800">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 flex items-center justify-center">
                                <i class="fas fa-sign-out-alt text-sm"></i>
                            </div>
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-200 group-hover:text-red-600 dark:group-hover:text-red-400">Logout</span>
                        </div>
                        <i class="fas fa-chevron-right text-xs text-gray-400 group-hover:text-red-500 dark:group-hover:text-red-400"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

   <div id="settingsMenu" class="hidden fixed bottom-16 left-4 w-72 bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 shadow-2xl rounded-2xl z-[9999] overflow-hidden transform transition-all duration-200 origin-bottom-left">
        <div class="p-2 space-y-1">
            <div class="px-3 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Account</div>
            <a href="profile.html" class="flex items-center gap-3 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-colors cursor-pointer group">
                <i class="fas fa-user-circle w-5 text-gray-400 group-hover:text-primary-500 transition-colors"></i>
                Profile
            </a>
        </div>
        <div class="h-px bg-gray-100 dark:bg-gray-700 mx-4"></div>
        <div class="p-2 space-y-1">
            <div class="px-3 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Preferences</div>
            <button id="themeAccordionBtn" class="w-full flex justify-between items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-colors cursor-pointer group focus:outline-none">
                <div class="flex items-center gap-3">
                    <i class="fas fa-palette w-5 text-gray-400 group-hover:text-primary-500 transition-colors"></i>
                    <span>Theme</span>
                </div>
                <i id="themeChevron" class="fas fa-chevron-right text-xs text-gray-400 transition-transform duration-200"></i>
            </button>
            <div id="themeOptionsContainer" class="hidden pl-4 pr-1 space-y-1 pb-1">
                <button data-value="light" class="theme-option w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors">
                    <span class="flex items-center gap-2"><i class="fas fa-sun text-orange-400 w-4"></i> Light</span>
                    <i class="fas fa-check text-primary-500 opacity-0 check-icon"></i>
                </button>
                <button data-value="dark" class="theme-option w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors">
                    <span class="flex items-center gap-2"><i class="fas fa-moon text-indigo-400 w-4"></i> Dark</span>
                    <i class="fas fa-check text-primary-500 opacity-0 check-icon"></i>
                </button>
                <button data-value="system" class="theme-option w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors">
                    <span class="flex items-center gap-2"><i class="fas fa-desktop text-gray-400 w-4"></i> System</span>
                    <i class="fas fa-check text-primary-500 opacity-0 check-icon"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="studentDetailOverlay" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm hidden transition-opacity">
    <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-[fadeIn_0.2s_ease-out] m-4">
        
        <div class="bg-gradient-to-r from-[#1E4A7A] to-[#0D2440] p-6 relative">
            <button id="closeStudentDetail" class="absolute top-4 right-4 text-white/70 hover:text-white transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
            <div class="flex items-center gap-4">
                <div id="studentOverlayInitials" class="h-16 w-16 rounded-full bg-white flex items-center justify-center text-[#1E4A7A] font-bold text-2xl shadow-lg border-4 border-white/20">
                    --
                </div>
                <div>
                    <h3 id="studentOverlayName" class="text-xl font-bold text-white">Student Name</h3>
                    <p id="studentOverlayId" class="text-blue-200 text-sm font-mono">ID: ---</p>
                </div>
            </div>
        </div>

        <div class="p-6">
            <div class="space-y-4 mb-6">
                <div class="flex items-center gap-3 text-gray-600 dark:text-gray-300">
                    <div class="w-8 flex justify-center"><i class="fas fa-envelope text-gray-400"></i></div>
                    <span id="studentOverlayEmail" class="text-sm">email@example.com</span>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-3 text-gray-600 dark:text-gray-300">
                        <div class="w-8 flex justify-center"><i class="fas fa-layer-group text-gray-400"></i></div>
                        <span class="text-sm">Sec: <strong id="studentOverlaySection" class="text-gray-900 dark:text-white">A</strong></span>
                    </div>
                    <div class="flex items-center gap-3 text-gray-600 dark:text-gray-300">
                        <div class="w-8 flex justify-center"><i class="fas fa-graduation-cap text-gray-400"></i></div>
                        <span id="studentOverlayYear" class="text-sm">-- Year</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-4 border-t border-gray-100 dark:border-gray-700 pt-6">
                <div class="text-center group cursor-default">
                    <p class="text-xs text-gray-500 uppercase tracking-wider mb-1">Solved</p>
                    <p id="overlaySolved" class="text-xl font-bold text-gray-800 dark:text-white group-hover:text-primary-500 transition-colors">0</p>
                </div>
                <div class="text-center border-l border-r border-gray-100 dark:border-gray-700 group cursor-default">
                    <p class="text-xs text-gray-500 uppercase tracking-wider mb-1">Rank</p>
                    <p id="overlayRank" class="text-xl font-bold text-yellow-600">#0</p>
                </div>
                <div class="text-center group cursor-default">
                    <p class="text-xs text-gray-500 uppercase tracking-wider mb-1">Points</p>
                    <p id="overlayPoints" class="text-xl font-bold text-green-600">0</p>
                </div>
            </div>

            <div class="mt-8 flex gap-3">
                <button class="flex-1 py-2.5 bg-primary-50 text-primary-700 hover:bg-primary-100 dark:bg-primary-900/20 dark:text-primary-400 dark:hover:bg-primary-900/40 rounded-lg text-sm font-medium transition-colors">
                    View Progress
                </button>
                <button class="flex-1 py-2.5 border border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg text-sm font-medium transition-colors">
                    Edit Profile
                </button>
            </div>
        </div>
    </div>
</div>

     <div id="notificationDropdown" class="fixed top-16 right-6 z-[70] w-80 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 hidden animate-[fadeIn_0.1s_ease-out]">
        <div class="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
            <h3 class="font-semibold text-gray-800 dark:text-white">Notifications</h3>
            <span class="text-xs text-primary-500 cursor-pointer hover:underline">Mark all read</span>
        </div>
        <div class="p-2">
            <div class="p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg cursor-pointer">
                <p class="text-sm text-gray-800 dark:text-gray-200 font-medium">System Update</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">Server maintenance scheduled for tonight.</p>
            </div>
             <div class="p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg cursor-pointer">
                <p class="text-sm text-gray-800 dark:text-gray-200 font-medium">New Student Enrollment</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">5 new students joined CS101.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            
            // --- SIDEBAR ---
            const sidebar = document.getElementById('mainSidebar');
            const toggleBtn = document.getElementById('sidebarToggleBtn');
            const logoText = document.getElementById('sidebarLogoText');
            if (toggleBtn && sidebar) {
                toggleBtn.addEventListener('click', () => {
                    sidebar.classList.toggle('collapsed');
                    const isCollapsed = sidebar.classList.contains('collapsed');
                    sidebar.classList.toggle('w-64', !isCollapsed);
                    sidebar.classList.toggle('w-20', isCollapsed);
                    if(logoText) logoText.style.display = isCollapsed ? 'none' : 'inline';
                });
            }

            // --- THEME & SETTINGS ---
            const settingsTrigger = document.getElementById('settingsTrigger');
            const settingsMenu = document.getElementById('settingsMenu');
            const themeBtn = document.getElementById('themeToggleBtn');
            const themeIcon = themeBtn?.querySelector('i');
            const html = document.documentElement;

            function applyTheme(theme) {
                if (theme === 'dark') { html.classList.add('dark'); localStorage.theme = 'dark'; }
                else if (theme === 'light') { html.classList.remove('dark'); localStorage.theme = 'light'; }
                else {
                    localStorage.removeItem('theme');
                    if (window.matchMedia('(prefers-color-scheme: dark)').matches) html.classList.add('dark');
                    else html.classList.remove('dark');
                }
                if(themeIcon) themeIcon.className = html.classList.contains('dark') ? 'fas fa-sun text-xl' : 'fas fa-moon text-xl';
            }

            // Init Theme
            applyTheme(localStorage.theme || 'system');

            // Theme Toggle Button (Header)
            if(themeBtn) themeBtn.addEventListener('click', () => applyTheme(html.classList.contains('dark') ? 'light' : 'dark'));

            // Settings Menu Toggle
            if(settingsTrigger && settingsMenu) {
                settingsTrigger.addEventListener('click', (e) => {
                    e.stopPropagation();
                    settingsMenu.classList.toggle('hidden');
                    // Position fix based on sidebar state
                    settingsMenu.style.left = (sidebar && sidebar.classList.contains('collapsed')) ? '80px' : '16px';
                });
                document.addEventListener('click', (e) => {
                    if(!settingsMenu.contains(e.target)) settingsMenu.classList.add('hidden');
                });
            }

            // Theme Accordion in Settings
            const accordionBtn = document.getElementById('themeAccordionBtn');
            const themeOpts = document.getElementById('themeOptionsContainer');
            if(accordionBtn && themeOpts) {
                accordionBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    themeOpts.classList.toggle('hidden');
                });
                document.querySelectorAll('.theme-option').forEach(opt => {
                    opt.addEventListener('click', (e) => applyTheme(opt.dataset.value));
                });
            }

            // --- OVERLAYS (Generic Close Logic) ---
            const setupOverlay = (triggerId, overlayId, closeId) => {
                const trigger = document.getElementById(triggerId);
                const overlay = document.getElementById(overlayId);
                const close = document.getElementById(closeId);
                if(trigger && overlay) trigger.addEventListener('click', (e) => { e.stopPropagation(); overlay.classList.remove('hidden'); });
                if(close && overlay) close.addEventListener('click', () => overlay.classList.add('hidden'));
                if(overlay) overlay.addEventListener('click', (e) => { if(e.target === overlay) overlay.classList.add('hidden'); });
            };

            setupOverlay('headerProfileBtn', 'profileOverlay', 'closeProfileOverlay');
            setupOverlay('notificationBtn', 'notificationDropdown', null); // Notification has no explicit X button

            // --- STUDENT FORM TOGGLE ---
            const btnAdd = document.getElementById('btn-add-student');
            const btnBack = document.getElementById('btn-back-to-student-list');
            const btnCancel = document.getElementById('btn-cancel-student-form');
            const listContainer = document.getElementById('student-list-container');
            const formContainer = document.getElementById('student-form-view');

            const toggleForm = (show) => {
                listContainer.classList.toggle('hidden', show);
                formContainer.classList.toggle('hidden', !show);
            };

            if(btnAdd) btnAdd.addEventListener('click', () => toggleForm(true));
            if(btnBack) btnBack.addEventListener('click', () => toggleForm(false));
            if(btnCancel) btnCancel.addEventListener('click', () => toggleForm(false));

            // --- NEW: STUDENT DETAIL OVERLAY LOGIC ---
            const studentRows = document.querySelectorAll('.student-row');
            const studentOverlay = document.getElementById('studentDetailOverlay');
            const closeStudentOverlay = document.getElementById('closeStudentDetail');

            // Elements to update
            const oName = document.getElementById('studentOverlayName');
            const oId = document.getElementById('studentOverlayId');
            const oEmail = document.getElementById('studentOverlayEmail');
            const oSection = document.getElementById('studentOverlaySection');
            const oYear = document.getElementById('studentOverlayYear');
            const oInitials = document.getElementById('studentOverlayInitials');
            // Stats
            const oSolved = document.getElementById('overlaySolved');
            const oRank = document.getElementById('overlayRank');
            const oPoints = document.getElementById('overlayPoints');

            studentRows.forEach(row => {
                row.addEventListener('click', () => {
                    const d = row.dataset;
                    if(oName) oName.innerText = d.name;
                    if(oId) oId.innerText = `ID: ${d.id}`;
                    if(oEmail) oEmail.innerText = d.email;
                    if(oSection) oSection.innerText = d.section;
                    if(oYear) oYear.innerText = d.year;
                    if(oSolved && d.solved) oSolved.innerText = d.solved;
                    if(oRank && d.rank) oRank.innerText = d.rank;
                    if(oPoints && d.points) oPoints.innerText = d.points;

                    if(oInitials) {
                        const initials = d.name.split(' ').map(n=>n[0]).join('').toUpperCase().substring(0,2);
                        oInitials.innerText = initials;
                    }
                    studentOverlay.classList.remove('hidden');
                });
            });

            if(closeStudentOverlay) closeStudentOverlay.addEventListener('click', () => studentOverlay.classList.add('hidden'));
            if(studentOverlay) studentOverlay.addEventListener('click', (e) => { if(e.target === studentOverlay) studentOverlay.classList.add('hidden'); });

        });
    </script>
</body>
</html>